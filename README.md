[![Go Reference](https://pkg.go.dev/badge/github.com/restatedev/sdk-go.svg)](https://pkg.go.dev/github.com/restatedev/sdk-go)
[![Go](https://github.com/restatedev/sdk-go/actions/workflows/test.yaml/badge.svg)](https://github.com/restatedev/sdk-go/actions/workflows/test.yaml)

# Restate Go SDK

[Restate](https://restate.dev/) is a system for easily building resilient applications using *distributed durable async/await*. This repository contains the Restate SDK for writing services in **Golang**.

## Community

* ðŸ¤—ï¸ [Join our online community](https://discord.gg/skW3AZ6uGd) for help, sharing feedback and talking to the community.
* ðŸ“– [Check out our documentation](https://docs.restate.dev) to get quickly started!
* ðŸ“£ [Follow us on Twitter](https://twitter.com/restatedev) for staying up to date.
* ðŸ™‹ [Create a GitHub issue](https://github.com/restatedev/sdk-java/issues) for requesting a new feature or reporting a problem.
* ðŸ  [Visit our GitHub org](https://github.com/restatedev) for exploring other repositories.

## Prerequisites
- Go: >= 1.24.0

## Examples

This repo contains an [example](examples) based on the [Ticket Reservation Service](https://github.com/restatedev/examples/tree/main/tutorials/tour-of-restate-go).

You can also check a list of examples available here: https://github.com/restatedev/examples?tab=readme-ov-file#go

### How to use the example

Download and run restate, as described here [v1.x](https://github.com/restatedev/restate/releases/)

```bash
restate-server
```

In another terminal run the example

```bash
cd restate-sdk-go/example
go run .
```

In a third terminal register:

```bash
restate deployments register http://localhost:9080
```

And do the following steps

- Add tickets to basket

```bash
curl -v localhost:8080/UserSession/azmy/AddTicket \
    -H 'content-type: application/json' \
    -d '"ticket-1"'

# true
curl -v localhost:8080/UserSession/azmy/AddTicket \
    -H 'content-type: application/json' \
    -d '"ticket-2"'
# true
```

Trying adding the same tickets again should return `false` since they are already reserved. If you didn't check out the tickets in 15min (if you are impatient change the delay in code to make it shorter)

- Check out

```bash
curl localhost:8080/UserSession/azmy/Checkout
# true
```

## Ingress SDK

When you need to call restate handlers or attach to invocations from outside the restate context,
use the [ingress SDK](examples/client/main.go).

## Versions

This library follows [Semantic Versioning](https://semver.org/).

The compatibility with Restate is described in the following table:

| Restate Server\sdk-go | < 0.16           | 0.16 - 0.17 | 0.18 - 0.19      | 0.20 - 0.21      |
|-----------------------|------------------|-------------|------------------|------------------|
| < 1.3                 | âœ…                | âŒ           | âŒ                | âŒ                |
| 1.3                   | âœ…                | âœ…           | âœ… <sup>(1)</sup> | âœ… <sup>(2)</sup> |
| 1.4                   | âœ…                | âœ…           | âœ…                | âœ… <sup>(2)</sup> |
| 1.5                   | âš  <sup>(3)</sup> | âœ…           | âœ…                | âœ…                |

<sup>(1)</sup> **Note** `WithAbortTimeout`, `WithEnableLazyState`, `WithIdempotencyRetention`, `WithInactivityTimeout`, `WithIngressPrivate`, `WithJournalRetention` and `WithWorkflowRetention` work only from Restate 1.4 onward. Check the in-code documentation for more details.

<sup>(1)</sup> **Note** `WithInvocationRetryPolicy` works only from Restate 1.5 onward. Check the in-code documentation for more details.

<sup>(3)</sup> **Warning** SDK versions < 0.16 are deprecated, and cannot be registered anymore. Check the [Restate 1.5 release notes](https://github.com/restatedev/restate/releases/tag/v1.5.0) for more info.

## Contributing

Weâ€™re excited if you join the Restate community and start contributing!
Whether it is feature requests, bug reports, ideas & feedback or PRs, we appreciate any and all contributions.
We know that your time is precious and, therefore, deeply value any effort to contribute!

### Internal core

To rebuild the internal core:

```shell
cd shared-core
cargo build --release
mv target/wasm32-unknown-unknown/release/shared_core_golang_wasm_binding.wasm ../internal/statemachine
```

To regenerate the protobuf contract between core and SDK:

```shell
buf generate --template internal.buf.gen.yaml
```

## Mockery mocks
The `mock` package is mostly autogenerated but will require some very light editing. To generate run `mockery` in the root of this repo. Then check the git diff.
Certain structs (`MockAfterFuture`, `MockAttachFuture`, `MockAwakeableFuture`, `MockDurablePromise`, `MockResponseFuture`) and functions (`NewMockClient`, `NewMockContext`)
have been redefined in `helpers.go` and commented out in their respective files. Please continue this state of affairs if you regenerate mocks - not doing so will be a build
error.
